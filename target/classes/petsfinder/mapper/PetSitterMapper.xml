<?xml version="1.0" encoding="UTF-8"?>


<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="petsfinder.petsitter.PetSitterDAOImpl">

	<select id="sitterView" resultType="petsfinder.petsitter.PetSitterDTO">
	
	select 
    s.member_idx,
    s.sit_idx, sit_title, sit_intro, sit_addr, s_fee, m_fee, b_fee, sit_client, sit_startpoint, sit_startcount,
    member_name, pet_idx, pet_age, pet_name, pet_gender
	from 
	    sitter s
	inner join pet p on s.member_idx = p.member_idx 
	inner join member m on s.member_idx = m.member_idx
	where s.member_idx=#{member_idx}

	</select>
	
	<select id="stReview" resultType="petsfinder.review.ReviewBoardDTO">
	
		select
		    a.*, NVL(b.countlike, 0) as countlike
		from
		    ( select 
		        r.*, m.member_name member_namer
		    from 
		        review_board r, member m 
		    where 
		        r.member_idx = m.member_idx and sit_idx = #{ param1 }
		    order by review_idx desc ) a
		left outer join
		    ( select
		        review_idx, count(review_idx) countlike
		    from 
		        review_like
		    where
		        reviewLike_stt = 1 
		    group by review_idx ) b
		on a.review_idx = b.review_idx
	
	</select>
	
	
	<select id="avalService" resultType="petsfinder.petsitter.PetSitterDTO">
	
	select typsrv_expln , typSrv_service from type_service 
	where typsrv_idx in (select typsrv_idx from available_services 
	where sit_idx = #{ sit_idx })
	order by typsrv_idx asc
	</select>
	
	<select id="sitterTag" resultType="petsfinder.petsitter.PetSitterDTO">
	
	select typTag_expln from type_tag where typTag_idx in (select typTag_idx from sitter_tag where sit_idx=#{ sit_idx })
	
	</select>

	<!-- <select id="sitterView" resultType="petsfinder.petsitter.PetSitterDTO">
		SELECT * FROM sitter WHERE member_idx = #{member_sidx}
	</select>
	
	<select id="stMember" resultType="petsfinder.member.MemberDTO">
		SELECT * FROM member WHERE member_idx = #{member_idx}
	</select>
	
	<select id="stPet" resultType="petsfinder.member.PetDTO">
		SELECT * FROM pet WHERE member_idx = #{member_idx}
	</select>
	
	<select id="stReview" resultType="petsfinder.petsitter.PetSitterDTO">
		SELECT * FROM review_board WHERE sit_idx = #{sit_idx}
	</select>
	 -->
	
	<select id="sit_tag" resultType="String">
		select typtag_expln from type_tag where typtag_idx in (select typtag_idx from sitter_tag where sit_idx = #{ sit_idx })
	</select>
	
	<select id="sit_service" resultType="Integer">
		select typsrv_idx from available_services where sit_idx = #{ sit_idx }
	</select>
	
</mapper>